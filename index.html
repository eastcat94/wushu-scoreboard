<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>实时成绩看板</title>
<style>
  :root{--bg:#071226;--card:#0d1b2a;--accent:#f4c94e;--muted:#97a0b3;color-scheme:dark}

  /* 基础重设：隐藏滚动条，整页居中 */
  html, body {
    height: 100%;
    margin: 0;
    overflow: hidden; /* 关键：禁止滚动条 */
    font-family: "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
    background: var(--bg);
    color: #fff;
  }
  body {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* 缩放容器：使用 translate(-50%,-50%) + scale 居中 */
  #scaleWrap {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: top center;
    /* transform 在 JS 中设置为 translate(-50%,-50%) scale(...) */
  }

  /* 内部容器不再通过外边距撑高，避免滚动 */
  .wrap {
    max-width: 1200px;
    padding: 28px;
    box-sizing: border-box;
    margin: 0;
  }

  header{text-align:center;margin-bottom:6px}
  header img{max-width:480px;height:auto;display:inline-block;border:4px solid #fff; max-height:120px; object-fit:contain;}

  .title{font-size:56px;font-weight:800;margin:12px 0 6px;text-align:center}
  .name-eng{font-size:36px;font-weight:800;text-align:center;margin:6px 0}
  .name-chn{font-size:32px;text-align:center;margin:6px 0;color:var(--muted)}
  .club{font-size:20px;text-align:center;margin:6px 0;color:var(--muted)}

  .scores-row{display:flex;gap:18px;justify-content:center;align-items:stretch;margin-top:26px}
  .score-card{background:var(--card);padding:26px;border-radius:10px;min-width:220px;box-shadow:0 2px 6px rgba(0,0,0,0.2)}
  .label{font-size:14px;color:var(--muted);margin-bottom:6px;text-align:center}
  .value{font-size:36px;font-weight:900;text-align:center}

  .final-label{display:inline-block;background:var(--accent);color:#000;padding:10px 16px;border-radius:8px;font-weight:700;margin-top:22px}
  .final-score{font-size:120px;font-weight:900;color:var(--accent);margin:20px 0 8px;text-align:center}
  .meta{font-size:13px;color:var(--muted);text-align:center;margin-top:10px}

  .debug{position:fixed;right:12px;top:12px;background:#fff;color:#000;padding:10px;border-radius:8px;font-size:12px;z-index:9999;max-width:420px;overflow:auto;white-space:pre-wrap;display:none}

  /* 响应式：窗口较小时压缩字号并改为纵向堆叠 */
  @media (max-width: 900px) {
    .title{font-size:34px}
    .final-score{font-size:64px}
    .scores-row{flex-direction:column}
    header img{max-height:90px}
  }
</style>
</head>
<body>
  <div id="scaleWrap">
    <div class="wrap">

        <header>
            <!-- 你的本地图像路径不变 -->
            <img id="banner" src="./jun-wei-banner.jpg" alt="banner">
        </header>

    <div class="title" id="sheetTitle">—</div>
    <div class="name-eng" id="nameEng">—</div>
    <div class="name-chn" id="nameChn">—</div>
    <div class="club" id="club">—</div>

    <div class="scores-row" style="margin-top:20px">
      <div class="score-card">
        <div class="label" id="labelA">A组得分</div>
        <div class="value" id="valA">—</div>
      </div>
      <div class="score-card">
        <div class="label" id="labelB">B组得分</div>
        <div class="value" id="valB">—</div>
      </div>
      <div class="score-card">
        <div class="label" id="labelPenalty">裁判长扣分</div>
        <div class="value" id="valPenalty">—</div>
      </div>
    </div>

    <div style="text-align:center;margin-top:18px">
      <span class="final-label" id="finalLabel">Final Score 最终得分</span>
    </div>
    <div class="final-score" id="finalScore">—</div>

    <div class="meta">最后更新时间：<span id="updatedAt">-</span></div>
  </div>

  <div class="debug" id="debugBox" >
    <div><strong>Debug</strong></div>
    <div>GViz URL: <a id="gvizLink" href="#" target="_blank" rel="noopener noreferrer"></a></div>
    <div id="netStatus">状态: 等待</div>
    <pre id="netError" style="color:#900"></pre>
  </div>

<script>
/* 注意：数据抓取与解析逻辑未改动，仅替换 autoScale/布局相关代码 */

/* autoScale：计算 scale 并把 transform 设置为 translate(-50%,-50%) scale(...) 以确保容器绝对居中 */
function autoScale() {
    const designWidth = 1200;   // 你网页的最大宽度（保持原值）
    const designHeight = 900;   // 页面高度参考（可微调）

    const scaleX = window.innerWidth / designWidth;
    const scaleY = window.innerHeight / designHeight;

    const scale = Math.min(scaleX, scaleY);

    const wrap = document.getElementById("scaleWrap");
    // 使用 translate(-50%,-50%) + scale 保持中心点精确
    wrap.style.transform = `translate(-50%, -50%) scale(${scale})`;
}

/* 立即执行并监听窗口变化 */
autoScale();
window.addEventListener('resize', autoScale);

/* Same logic as the original file but with debug disabled by default */
const SPREADSHEET_ID = "1qGA-x86Xt7qEXwzO_Nx0RwaFr7yO2x3kocqA_nTfA0w";
const GID = "387691548";
const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;
const INTERVAL_MS = 3000;
const FIX_BASE_COL = 1; // B 列 index in gviz
const SHOW_DEBUG = false; // debug turned off

function setStatus(txt){ if (SHOW_DEBUG) document.getElementById('netStatus').innerText = '状态: ' + txt; }
function setError(txt){ if (SHOW_DEBUG) document.getElementById('netError').innerText = txt; console.error(txt); }

function parseGviz(text){
  return JSON.parse(text.replace(/^[\s\S]*?google\.visualization\.Query\.setResponse\(/, '').replace(/\);?\s*$/, ''));
}
function safeCell(rows, r, c){
  if (!rows || !rows[r] || !rows[r].c) return null;
  const cell = rows[r].c[c];
  if (!cell) return null;
  return (cell.v !== undefined) ? cell.v : (cell.f !== undefined ? cell.f : null);
}
function formatScore(v){
  if (v === null || v === undefined || v === '') return '—';
  const n = Number(v);
  if (isNaN(n)) return String(v);
  return n.toFixed(2); // always two decimals
}

async function fetchAndRender(){
  if (SHOW_DEBUG) document.getElementById('debugBox').style.display = 'block';
  try {
    const res = await fetch(GVIZ_URL, {cache:'no-store'});
    const txt = await res.text();
    const data = parseGviz(txt);
    const rows = data.table.rows;
    const baseCol = FIX_BASE_COL;

    document.getElementById('sheetTitle').innerText = safeCell(rows,0,baseCol) || '—';
    document.getElementById('nameEng').innerText = safeCell(rows,1,baseCol) || '—';
    document.getElementById('nameChn').innerText = safeCell(rows,2,baseCol) || '—';
    document.getElementById('club').innerText = safeCell(rows,3,baseCol) || '—';

    const labA = safeCell(rows,4,baseCol);
    const labB = safeCell(rows,4,baseCol+1);
    const labP = safeCell(rows,4,baseCol+2);
    if (labA) document.getElementById('labelA').innerText = String(labA);
    if (labB) document.getElementById('labelB').innerText = String(labB);
    if (labP) document.getElementById('labelPenalty').innerText = String(labP);

    const aVal = safeCell(rows,5,baseCol) ?? safeCell(rows,6,baseCol);
    const bVal = safeCell(rows,5,baseCol+1) ?? safeCell(rows,6,baseCol+1);
    const pVal = safeCell(rows,5,baseCol+2) ?? safeCell(rows,6,baseCol+2);

    document.getElementById('valA').innerText = formatScore(aVal);
    document.getElementById('valB').innerText = formatScore(bVal);
    document.getElementById('valPenalty').innerText = formatScore(pVal);

    const finalVal = safeCell(rows,7,baseCol) ?? safeCell(rows,6,baseCol) ?? safeCell(rows,5,baseCol);
    document.getElementById('finalScore').innerText = formatScore(finalVal);

    document.getElementById('updatedAt').innerText = new Date().toLocaleString();

    // 如果显示 debug，给出链接（保持原逻辑）
    const gvizLink = document.getElementById('gvizLink');
    if (gvizLink) {
      gvizLink.href = GVIZ_URL;
      gvizLink.innerText = 'Google Sheet (GViz)';
    }

  } catch (err) {
    console.error(err);
    setError(String(err));
  }
}

fetchAndRender();
setInterval(fetchAndRender, INTERVAL_MS);
</script>
    </div> <!-- end wrap -->
  </div> <!-- end scaleWrap -->
</body>
</html>
